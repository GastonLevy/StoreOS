{% extends 'index.html' %}

{% block title %}Detalles del Proveedor{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm border-light">
                <div class="card-header bg-light text-dark">
                    <i class="fas fa-info-circle me-1"></i> Información del Proveedor: <b>{{ supplier.name }}</b>
                </div>
                <div class="card-body">
                    <table class="table table-striped table-bordered">
                        <tbody>
                            <tr><th>Nombre</th><td>{{ supplier.name }}</td></tr>
                            <tr><th>Contacto</th><td>{{ supplier.contact }}</td></tr>
                            <tr><th>Correo Electrónico</th><td>{{ supplier.email }}</td></tr>
                            <tr><th>Teléfono</th><td>{{ supplier.phone }}</td></tr>
                            <tr><th>Dirección</th><td>{{ supplier.address }}</td></tr>
                            {% if supplier.receipt %}
                            <tr>
                                <th>Remito</th>
                                <td><a href="{{ supplier.receipt.url }}" target="_blank" class="btn btn-primary btn-sm">Ver Remito</a></td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{% url 'supplier-update' supplier.pk %}" class="btn btn-warning">Editar</a>
                        <a href="{% url 'supplier-delete' supplier.pk %}" class="btn btn-danger">Eliminar</a>
                        <a href="{% url 'supplier-list' %}" class="btn btn-secondary">Volver a la lista</a>
                    </div>
                </div>
            </div>
            <br>
            <!-- Lista de Entry Packs -->
            <div class="card shadow-sm border-light">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Entradas del Proveedor</h5>
                    <form method="POST" action="{% url 'entrypack-create' supplier.id %}" class="d-flex align-items-center">
                        {% csrf_token %}
                        <div class="form-group mb-0 me-3">
                            <textarea name="description" id="description" class="form-control" rows="1" placeholder="Descripción opcional"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Crear nueva entrada</button>
                    </form>
                </div>
                <div class="card-body">
                    {% if page_obj %}
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <label for="entriesPerPage">Mostrar:</label>
                        <select id="entriesPerPage" class="form-select form-select-sm w-auto" onchange="changeEntriesPerPage()">
                            <option value="10" {% if entries_per_page == 10 %}selected{% endif %}>10</option>
                            <option value="20" {% if entries_per_page == 20 %}selected{% endif %}>20</option>
                            <option value="50" {% if entries_per_page == 50 %}selected{% endif %}>50</option>
                        </select>
                    </div>
                    <table class="table table-striped table-bordered table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Descripción</th>
                                <th>Fecha de Creación</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pack in page_obj %}
                            <tr>
                                <td>{{ pack.description|default:"Sin descripción" }}</td>
                                <td>{{ pack.created_at|date:"d/m/Y H:i" }}</td>
                                <td>
                                    <a href="{% url 'entry-pack-detail' pack.pk %}" class="btn btn-info btn-sm">Ver</a>
                                    <a href="{% url 'entry-pack-delete' pack.pk %}" class="btn btn-danger btn-sm">Eliminar</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center">No hay entradas disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <!-- Paginación -->
                    <div class="d-flex justify-content-center mt-3">
                        <nav>
                            <ul class="pagination">
                                {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link text-dark" href="?page=1&entries={{ entries_per_page }}">Primera</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link text-dark" href="?page={{ page_obj.previous_page_number }}&entries={{ entries_per_page }}">Anterior</a>
                                </li>
                                {% endif %}
                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                    <li class="page-item active">
                                        <span class="page-link bg-dark text-white">{{ num }}</span>
                                    </li>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                    <li class="page-item">
                                        <a class="page-link text-dark" href="?page={{ num }}&entries={{ entries_per_page }}">{{ num }}</a>
                                    </li>
                                    {% endif %}
                                {% endfor %}
                                {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link text-dark" href="?page={{ page_obj.next_page_number }}&entries={{ entries_per_page }}">Siguiente</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link text-dark" href="?page={{ page_obj.paginator.num_pages }}&entries={{ entries_per_page }}">Última</a>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function changeEntriesPerPage() {
        const entries = document.getElementById("entriesPerPage").value;
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('entries', entries);
        currentUrl.searchParams.set('page', 1); // Resetear a la primera página
        window.location.href = currentUrl.toString();
    }
</script>
{% endblock %}
